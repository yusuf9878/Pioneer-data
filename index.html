<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pioneer Furniture Order's</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/parse/3.4.3/parse.min.js"></script>
<style>

@import url('https://fonts.googleapis.com/css2?family=Bungee+Spice&family=Kanit:wght@400;600;700&display=swap');

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Kanit', sans-serif;
  background-color: #f5f7fa;
  color: #333;
}

/* Navbar */
.navbar {
    width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 60px;
  background: linear-gradient(135deg, #1f1c2c, #928dab);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.navbar a {
  color: #ffffff;
  text-decoration: none;
  margin: 0 18px;
  font-weight: 600;
  font-size: 17px;
  padding: 5px 10px;
  transition: all 0.3s ease;
}

.navbar a:hover,
.navbar a.active {
  background-color: rgba(255, 255, 255, 0.15);
  color: #f1c40f;
}

/* Auth Button */
.authbtn {
  background: transparent;
  border: none;
  color: #fff;
  font-weight: 600;
  font-size: 16px;
  margin-left: 15px;
  cursor: pointer;
  transition: color 0.3s ease;
}

.authbtn:hover {
  color: #f1c40f;
}

/* Heading */
h1 {
  background: linear-gradient(90deg, #485563, #29323c);
  color: white;
  padding: 15px;
  font-size: 26px;
  text-align: center;
  font-weight: 600;
  letter-spacing: 1px;
}

/* Time Display */
.time {
  display: flex;
  justify-content: center;
  font-size: 18px;
  font-weight: 600;
  margin: 15px 0;
}

/* Toggle Button */
.toggle-btn {
  background-color: #2c3e50;
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 8px;
  font-weight: 600;
  font-size: 16px;
  cursor: pointer;
  transition: background 0.3s ease;
}

.toggle-btn:hover {
  background-color: #34495e;
}

/* Cart Container */
#cartContainer {
  max-width: 900px;
  margin: 30px auto;
  padding: 15px;
}

/* Cart Item */
.cart-item {
  background: white;
  border-radius: 10px;
  padding: 20px;
  margin-bottom: 25px;
  box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
  transition: all 0.3s ease;
}

.cart-item:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
}

.cart-item img {
  width: 100%;
  max-width: 300px;
  height: auto;
  border-radius: 10px;
  border: 2px solid #2980b9;
  margin-top: 10px;
}

.cart-item p {
  font-size: 16px;
  font-weight: 600;
  margin: 10px 0;
}

.cart-item hr {
  border-top: 1px solid #ddd;
  margin: 15px 0;
}

/* Buttons */
.btn1, .btn2 {
  width: 48%;
  height: 48px;
  border-radius: 6px;
  font-weight: 600;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.3s ease;
  border: none;
}

.btn1 {
  background-color: #3498db;
  color: white;
}

.btn2 {
  background-color: #27ae60;
  color: white;
}

.btn1:hover {
  background: #2980b9;
}

.btn2:hover {
  background: #1e8449;
}

/* Status Labels */
.status {
  display: inline-block;
  padding: 5px 12px;
  border-radius: 20px;
  font-weight: bold;
  font-size: 14px;
  color: white;
  text-align: center;
}

.status-pending {
  background-color: #f39c12;
}

.status-frame-ready {
  background-color: #2980b9;
}

.status-sofa-ready {
  background-color: #27ae60;
}

/* Highlighted Orders */
.highlight {
  border: 2px solid #f1c40f;
  box-shadow: 0 0 20px rgba(241, 196, 15, 0.7);
}

/* Add Order Button */
.add-order-btn {
  position: fixed;
  bottom: 25px;
  right: 25px;
  padding: 14px 28px;
  border-radius: 50px;
  font-weight: 700;
  font-size: 16px;
  background: linear-gradient(135deg, #ff6a00, #ee0979);
  color: white;
  border: none;
  cursor: pointer;
  box-shadow: 0 8px 20px rgba(255, 106, 0, 0.4);
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 10px;
}

.add-order-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 0 25px rgba(255, 106, 0, 0.8);
}

.addbtn a {
  color: #fff;
  text-decoration: none;
  font-size: 16px;
  font-weight: 600;
  text-shadow: 0 0 5px white;
}

/* Popup */
.popup {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.popup-content {
  background-color: #2c3e50;
  padding: 30px;
  border-radius: 10px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
  color: white;
  text-align: center;
}

.popup-content h2 {
  font-size: 22px;
  margin-bottom: 20px;
  text-shadow: 2px 2px 8px rgba(0,0,0,0.4);
}

.popup button {
  background-color: #1abc9c;
  color: white;
  font-weight: bold;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  cursor: pointer;
  margin: 10px;
  transition: all 0.3s ease;
}

.popup button:hover {
  background-color: #16a085;
  box-shadow: 0 0 10px rgba(26, 188, 156, 0.7);
}

/* Footer */
.footers {
  position: fixed;
  bottom: 0;
  left: 0;
  width: 100%;
  background: linear-gradient(to right, #8e9eab, #eef2f3);
  text-align: center;
  padding: 8px;
  font-size: 12px;
  font-weight: 600;
  color: #2c3e50;
  box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
}

/* Skeleton Loading */
.skeleton-card {
  height: 140px;
  border-radius: 12px;
  background: linear-gradient(90deg, #e0e0e0 25%, #f7f7f7 50%, #e0e0e0 75%);
  background-size: 200% 100%;
  animation: skeleton-loading 1.5s infinite;
  margin: 10px 0;
  box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
}

@keyframes skeleton-loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}


</style>
 
</head>
<body>
     <!-- Header Section -->
    <header>
        <h1>PIONEER FURNITURE</h1>
    </header>
    <!-- End Header Section -->
  <!-- Navbar -->
<!-- Navbar -->
<div class="navbar">
    <a href="home.html" class="home">Home</a>
    <a href="history.html">History</a>
    <a href="old-oders.html">Old History</a>
<!-- âœ… Navbar Me Auth Button -->
<button id="authBtn" class="authbtn">Auth</button>
</div>
  <!-- Time Display -->
  <div class="time" id="clock">00:00:00 AM/PM Sunday</div>

  <!-- Cart Container -->
  <div id="cartContainer"></div>

<div class="addbtn">
<a href="Submit.html" class="add-order-btn">
 Add Order
</a>
</div>


<!-- âœ… Add This Popup In Your HTML -->
<div id="userPopup" class="popup" style="display: none;">
    <div class="popup-content">
        <h2>Select Role</h2>
        <button onclick="setUserRole('guest')">Guest</button>
        <button onclick="setUserRole('author')">Author</button>
    </div>
</div>
<div id="skeleton-loader">
    <div class="skeleton-card"></div>
    <div class="skeleton-card"></div>
    <div class="skeleton-card"></div>
     <div class="skeleton-card"></div>
    <div class="skeleton-card"></div>
    <div class="skeleton-card"></div>
    <div class="skeleton-card"></div>
    <div class="skeleton-card"></div>
</div>

<div id="actual-content" style="display: none;">
</div>

<script>
// âœ… Global variable for user role
let userRole = null;

/* ---------- Time Management ---------- */
function updateClock() {
    let now = new Date();
    let hours = now.getHours();
    let minutes = now.getMinutes();
    let seconds = now.getSeconds();
    let dayIndex = now.getDay();  // ðŸŸ¢ Day Index (0-6)
    let days = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
    
    // âœ… Ensure dayIndex is valid
    let dayName = days[dayIndex] || "Unknown";

    let ampm = hours >= 12 ? "PM" : "AM";
    hours = hours % 12 || 12;

    let formattedTime = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')} ${ampm} | ${dayName}`;
    document.getElementById("clock").textContent = formattedTime;
}

// âœ… Har second update hoga
setInterval(updateClock, 1000);
updateClock();
</script>
<script>

/* ---------- User Role Popup (AUTH Button Click) ---------- */
document.getElementById("authBtn").addEventListener("click", () => {
    document.getElementById("userPopup").style.display = "flex";
});

function setUserRole(role) {
    if (role === "guest") {
        userRole = "guest";
        localStorage.setItem("role", "guest");
        alert("You are in guest mode. You can't take any action.");
        disableButtons();
    } else if (role === "author") {
        let id = prompt("Enter ID (Default: Admin):", "Admin");
        let pass = prompt("Enter Password (âŒâŒâŒ):", "");
        if (id === "Admin" && pass === "1234") {
            userRole = "author";
            localStorage.setItem("role", "author");
            alert("Welcome, Author! You can take action.");
            enableButtons();
        } else {
            alert("Invalid credentials. You will be treated as guest.");
            userRole = "guest";
            localStorage.setItem("role", "guest");
            disableButtons();
        }
    }
    // âœ… Popup hide after role selection
    document.getElementById("userPopup").style.display = "none";
}

/* ---------- Disable & Enable Buttons ---------- */
function disableButtons() {
    const buttons = document.querySelectorAll(".btn1, .btn2");
    buttons.forEach(button => {
        button.disabled = true;
        button.style.cursor = "not-allowed";
        button.style.opacity = "0.1"
    });
}

function enableButtons() {
    const buttons = document.querySelectorAll(".btn1, .btn2");
    buttons.forEach(button => {
        button.disabled = false;
        button.style.cursor = "pointer";
        button.style.opacity = "1"
    });
}

/* ---------- Load Orders From Back4App ---------- */
async function loadOrders() {
    Parse.initialize("ZplkGt31jAygD6lYfS0QtTWA9BVVcWYYuavsXSbd", "YEZy7qplfvNG4oAzFY6B6J7h6xuXU1mw5zdnhESE");
    Parse.serverURL = "https://parseapi.back4app.com/";
    
    const Order = Parse.Object.extend("Orders");
    const query = new Parse.Query(Order);

    try {
        let results = await query.find();
      
       if (results.length === 0) {
  document.getElementById("cartContainer").innerHTML = `
    <div style="display:flex; justify-content:center; align-items:center; flex-direction:column; height:70vh;">
      <img src="https://cdn-icons-png.flaticon.com/512/4076/4076549.png" width="150" style="opacity:0.5;">
      <h2 style="color:gray; margin-top:20px;">No Orders Found</h2>
    </div>
  `;
  return;
}
        results = results.map(order => {
            let imageHTML = "";

            // âœ… **Single Image (file)**
            let singleImage = order.get("file");
            if (singleImage && typeof singleImage.url === "function") {
                imageHTML += `<img src="${singleImage.url()}" width="100"> `;
            }

            // âœ… **Multiple Images (array)**
            let multipleImages = order.get("images"); // Yeh array hai jo multiple images rakhta hai
            if (multipleImages && Array.isArray(multipleImages)) {
                multipleImages.forEach(img => {
                    if (img && typeof img.url === "function") {
                        imageHTML += `<img src="${img.url()}" width="100"> `;
                    }
                });
            }

            return {
                objectId: order.id,
                billNumber: order.get("billNumber"),
                details: order.get("details"),
                dueDate: new Date(order.get("dueDate")),  // âœ… Convert to Date Object
                formattedDueDate: formatDate(order.get("dueDate")),
                urgent: order.get("urgent") ? "ðŸ”´ Urgent" : "âœ… Normal",
                image: imageHTML, // âœ… Image HTML
                status: order.get("status") || "PENDING"
            };
        })
        // âœ… **Sort by Due Date (Nearest Due Date First)**
        .sort((a, b) => a.dueDate - b.dueDate);

        let cartHTML = "<h2>Your Orders</h2>";
        results.forEach(order => {
            let statusClass = getStatusClass(order.status);
            cartHTML += `
                <div class="cart-item" id="order-${order.objectId}">
                    <p><strong style="color:red;">Status:</strong> 
                        <span id="status-${order.objectId}" class="status ${statusClass}">${order.status}</span>
                    </p>
                    <p><strong style="color:red;">Bill No:</strong> ${order.billNumber}</p>
                    <p><strong style="color:red;">Details:</strong> ${order.details}</p>
                    <p><strong style="color:red;">Due Date:</strong> ${order.formattedDueDate}</p>
                    <p><strong style="color:red;">Time:</strong> ${order.urgent}</p>
                    <p>${order.image}</p> <!-- âœ… Multiple images properly show hongi -->
                    <hr>
                    <button class="btn1" id="frame-${order.objectId}" onclick="updateStatus('${order.objectId}', 'FRAME READY')" ${order.status !== 'PENDING' ? 'style="display:none;"' : ''}>
                        click for Frame Ready
                    </button>
                    <button class="btn2" id="sofa-${order.objectId}" onclick="updateStatus('${order.objectId}', 'SOFA READY âœ”ï¸')" ${order.status !== 'FRAME READY' ? 'style="display:none;"' : ''}>
                        click for Sofa Ready
                    </button>
                </div>
            `;
        });

// âœ… Load orders function ko call karo
setTimeout(loadOrders, 500);
        document.getElementById("cartContainer").innerHTML = cartHTML;
        
        if (userRole !== "author") { 
            disableButtons(); 
        } else { 
            enableButtons(); 
        }

    } catch (error) {
        console.error("Error fetching orders:", error);
    }
}

// âœ… Status ke liye CSS class return karega
function getStatusClass(status) {
    switch (status) {
        case "PENDING": return "status-pending";
        case "FRAME READY": return "status-frame-ready";
        case "SOFA READY âœ”ï¸": return "status-sofa-ready";
        default: return "";
    }
}

/* ---------- Update Order Status Function ---------- */
async function updateStatus(objectId, newStatus) {
    if (userRole !== "author") {
        alert("Guests cannot perform actions.");
        return;
    }

    let Order = Parse.Object.extend("Orders");
    let query = new Parse.Query(Order);
    query.equalTo("objectId", objectId);

    try {
        let order = await query.first();
        if (order) {
            order.set("status", newStatus);
            await order.save();

            // âœ… UI Update
            let statusElement = document.getElementById(`status-${objectId}`);
            let frameButton = document.getElementById(`frame-${objectId}`);
            let sofaButton = document.getElementById(`sofa-${objectId}`);
            let orderElement = document.getElementById(`order-${objectId}`); // âœ… Order Element Fetch

            if (statusElement) {
                statusElement.textContent = newStatus;
                statusElement.className = `status ${getStatusClass(newStatus)}`;
            }

            // âœ… Button Text & Visibility Update
            if (newStatus === "FRAME READY") {
                frameButton.style.display = "none";  // Hide "Frame Ready"
                sofaButton.style.display = "inline-block"; // Show "Sofa Ready"
            } 
            else if (newStatus === "SOFA READY âœ”ï¸") {
                sofaButton.style.display = "none";  // Hide "Sofa Ready"

                console.log("âœ… Order will be removed after 10 sec:", objectId);
                
                // âœ… 2 Sec Ke Baad Cart Remove Karo
                setTimeout(async () => {
                    if (orderElement) {
                        orderElement.remove(); // âœ… Cart hatao
                        console.log("âœ… Order removed from UI:", objectId);
                        
                        // âœ… Order ko History me Save Karo (NO IMAGE)
                        await moveOrderToHistory(order);
                    }
                }, 2000);
            }
        }
    } catch (error) {
        console.error("âŒ Error updating order:", error);
    }
}


/* ------- Move Order to History  ---------- */
async function moveOrderToHistory(order) {
    const HistoryOrder = Parse.Object.extend("HistoryOrders");
    let historyEntry = new HistoryOrder();

    historyEntry.set("billNumber", order.get("billNumber"));
    historyEntry.set("moveDate", new Date());

    try {
        await historyEntry.save();
        console.log("âœ… Order moved to History");
        
        // âœ… Original Order Delete Karo
        await order.destroy();
        console.log("âœ… Original Order Deleted");
    } catch (error) {
        console.error("âŒ Error moving to history:", error);
    }
}

/* ---------- Format Date ---------- */
function formatDate(dateString) {
    let date = new Date(dateString);
    let day = String(date.getDate()).padStart(2, "0");
    let monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
    let month = monthNames[date.getMonth()];
    let year = date.getFullYear();
    return `${day}/${month}/${year}`;
}

/* ---------- Navbar Active Link Highlight ---------- */
window.onload = function() {
    var navLinks = document.querySelectorAll('.navbar a');
    navLinks.forEach(function(link) {
        if (link.href === window.location.href) {
            link.classList.add('active');
        }
    });
};

// âœ… Load orders after a short delay so that role selection is processed
setTimeout(loadOrders, 500);

// âœ… Disable button par tap hone par notification dikhane ka function
function showAuthNotification(event) {
    alert("You are Not Authenticate People"); // âœ… Alert message
    event.preventDefault(); // âœ… Default action ko rokne ke liye
}

// âœ… Disable hone wale buttons par event listener add karo
function attachDisableButtonListeners() {
    const buttons = document.querySelectorAll(".btn1:disabled, .btn2:disabled");
    buttons.forEach(button => {
        button.addEventListener("click", showAuthNotification);
    });
}

// âœ… Disable buttons function ko update karo
function disableButtons() {
    const buttons = document.querySelectorAll(".btn1, .btn2");
    buttons.forEach(button => {
        button.disabled = true;
        button.style.cursor = "not-allowed";
        button.style.opacity = "0.5"; // âœ… Opacity kam karo
        button.addEventListener("click", showAuthNotification); // âœ… Event listener add karo
    });
}

// âœ… Enable buttons function ko update karo
function enableButtons() {
    const buttons = document.querySelectorAll(".btn1, .btn2");
    buttons.forEach(button => {
        button.disabled = false;
        button.style.cursor = "pointer";
        button.style.opacity = "1"; // âœ… Opacity wapas normal karo
        button.removeEventListener("click", showAuthNotification); // âœ… Event listener remove karo
    });
}
// âœ… Toast Notification Function
function showToast(message) {
    let toast = document.createElement("div");
    toast.className = "toast show";
    toast.innerText = message;
    document.body.appendChild(toast);

    // âœ… 3 Seconds ke baad hide aur remove ho jayega
    setTimeout(() => {
        toast.classList.add("hide");
        setTimeout(() => toast.remove(), 500); 
    }, 3000);
}

// âœ… Disable hone wale buttons par event listener add karo
function attachDisableButtonListeners() {
    const buttons = document.querySelectorAll(".btn1:disabled, .btn2:disabled");
    buttons.forEach(button => {
        button.addEventListener("click", (event) => {
            showToast("You are Not Authenticate People"); // âœ… Toast Notification
            event.preventDefault(); // âœ… Default click action ko rokna
        });
    });
}

// âœ… Disable buttons function ko update karo
function disableButtons() {
    const buttons = document.querySelectorAll(".btn1, .btn2");
    buttons.forEach(button => {
        button.disabled = true;
        button.style.cursor = "not-allowed";
        button.style.opacity = "0.5"; // âœ… Opacity kam karo
        button.addEventListener("click", (event) => {
            showToast("You are Not Authenticate People"); // âœ… Mobile-friendly notification
            event.preventDefault();
        });
    });
}

// âœ… Enable buttons function ko update karo
function enableButtons() {
    const buttons = document.querySelectorAll(".btn1, .btn2");
    buttons.forEach(button => {
        button.disabled = false;
        button.style.cursor = "pointer";
        button.style.opacity = "1"; // âœ… Opacity wapas normal karo
        button.removeEventListener("click", showToast);
    });
}

setTimeout(() => {
    document.getElementById("skeleton-loader").style.display = "none"; // Skeleton Hide
    document.getElementById("actual-content").style.display = "block"; // Actual Data Show
}, 2000); // Simulated delay (2 sec)
</script>



  <div class="footers">
    <p>
      Created By <a href="https://pioneerfurnituredata.netlify.app/about.html"><b>YUSUF KHAN</b></a>
    </p>
  </div>
</body>
</html>
